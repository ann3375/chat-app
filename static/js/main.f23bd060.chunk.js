(this["webpackJsonpchat-app"]=this["webpackJsonpchat-app"]||[]).push([[0],{100:function(e,t,n){},101:function(e,t,n){},102:function(e,t,n){},103:function(e,t,n){},104:function(e,t,n){},105:function(e,t,n){},204:function(e,t,n){},205:function(e,t,n){},206:function(e,t,n){},207:function(e,t,n){},208:function(e,t,n){},209:function(e,t,n){},210:function(e,t,n){},211:function(e,t,n){},212:function(e,t,n){},213:function(e,t,n){},214:function(e,t,n){},215:function(e,t,n){},216:function(e,t,n){},217:function(e,t,n){},218:function(e,t,n){},219:function(e,t,n){},220:function(e,t,n){},221:function(e,t,n){},222:function(e,t,n){},223:function(e,t,n){},224:function(e,t,n){"use strict";n.r(t);var a,s,r=n(1),i=n.n(r),c=n(42),o=n.n(c),l=n(23),u=n(10),d=n(20),f=n(5),m=n(2),j=n(4),b=n.n(j),h=(n(88),n(0)),g=function(e){var t,n=e.children,a=e.type,s=e.isDisabled,r=e.variant,i=e.className,c=e.size,o=e.path,u=e.isNavLink,d=e.arialabel,f=e.onClick,j=b()("button",(t={},Object(m.a)(t,"button_size_".concat(c),c),Object(m.a)(t,"button_variant_".concat(r),r),Object(m.a)(t,"".concat(i),i),t));return u&&o?Object(h.jsx)(l.b,{className:j,to:o,children:n}):Object(h.jsx)("button",{onClick:f,type:a,disabled:s,className:j,"aria-label":d,children:n})},p=n(13),O=n(21),v=(n(94),["className","children","flex","row","align","column","refBlock"]),x=function(e){var t,n=e.className,a=e.children,s=e.flex,r=e.row,i=e.align,c=e.column,o=e.refBlock,l=Object(O.a)(e,v),u=b()("",(t={},Object(m.a)(t,"wrapper_flex",s),Object(m.a)(t,"wrapper_flex_column",c),Object(m.a)(t,"wrapper_flex_row",r),Object(m.a)(t,"wrapper_flex_align_".concat(i),i),Object(m.a)(t,"".concat(n),n),t));return Object(h.jsx)("div",Object(p.a)(Object(p.a)({ref:o,className:u},l),{},{children:a}))};!function(e){e.h1="h1",e.h2="h2",e.h3="h3",e.h4="h4",e.p1="p1",e.p2="p2",e.p3="p3",e.span="span"}(s||(s={}));var _=(a={},Object(m.a)(a,s.h1,"h1"),Object(m.a)(a,s.h2,"h2"),Object(m.a)(a,s.h3,"h3"),Object(m.a)(a,s.h4,"h4"),Object(m.a)(a,s.p1,"p"),Object(m.a)(a,s.p2,"p"),Object(m.a)(a,s.p3,"p"),Object(m.a)(a,s.span,"span"),a),N=(n(95),["variant","children","color","className"]),S=function(e){var t,n=e.variant,a=e.children,s=e.color,r=e.className,i=Object(O.a)(e,N),c=_[n];return Object(h.jsx)(c,Object(p.a)(Object(p.a)({className:b()("typography",(t={},Object(m.a)(t,"typography_variant_".concat(n),n),Object(m.a)(t,"typography_color_".concat(s),s),Object(m.a)(t,"".concat(r),r),t))},i),{},{children:a}))};var E,y,k={VIDEO:["video/mp4","video/ogg","video/webm"],AUDIO:["audio/mpeg","audio/ogg"],IMAGE:["image/jpg","image/jpeg","image/gif","image/png","image/svg+xml"]},I=n(3),w=n.n(I),L=n(11),D=["name"],C=function(e){var t=e.name,a=Object(O.a)(e,D),s=i.a.useRef(),c=Object(r.useState)(!1),o=Object(f.a)(c,2),l=o[0],u=o[1];if(i.a.useEffect((function(){u(!0);var e=function(){var e=Object(L.a)(w.a.mark((function e(){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n(97)("./".concat(t,".svg"));case 3:s.current=e.sent.default,e.next=10;break;case 6:throw e.prev=6,e.t0=e.catch(0),console.log(e.t0),e.t0;case 10:return e.prev=10,u(!1),e.finish(10);case 13:case"end":return e.stop()}}),e,null,[[0,6,10,13]])})));return function(){return e.apply(this,arguments)}}();return e(),function(){u(!1)}}),[t]),!l&&s.current){var d=s.current;return Object(h.jsx)(d,Object(p.a)({},a))}return null};!function(e){e.inputError="inputError",e.sendMessage="sendMessage",e.addFile="addFile",e.logo="logo",e.maleAvatar="maleAvatar",e.femaleAvatar="femaleAvatar",e.noUserAvatar="noUserAvatar",e.userIcon="userIcon",e.userList="userList",e.arrowLeft="arrowLeft",e.closeIcon="closeIcon",e.spiner="spiner",e.spinnerCircle="spinnerCircle",e.updateIcon="updateIcon",e.arrowDown="arrowDown",e.deleteIcon="deleteIcon",e.closeCircleIcon="closeCircleIcon"}(E||(E={})),function(e){e.error="tomato",e.primary="cornflowerblue",e.grey="lightgray",e.darkGrey="darkgrey",e.mediumBlue="mediumBlue"}(y||(y={}));n(98);var A,U,T=function(e){var t=e.className,n=b()("spinner",Object(m.a)({},"".concat(t),t));return Object(h.jsx)(x,{className:n,children:Object(h.jsx)(C,{name:E.spiner,className:"spinner__icon"})})},R=(n(99),function(e){var t,n,a=e.file,i=e.className,c=e.handleImageClick,o=b()("file-block",Object(m.a)({},"".concat(i),i)),l=Object(r.useState)(!1),u=Object(f.a)(l,2),d=u[0],j=u[1];return Object(h.jsxs)(x,{className:o,children:[d?Object(h.jsxs)(x,{flex:!0,align:"center",className:"file-block__info",children:[Object(h.jsx)(S,{className:"file-block__filename",variant:s.p1,children:(n=a.fileName,n.length>80?n.slice(0,80)+".."+n.slice(n.lastIndexOf(".")):n)}),Object(h.jsx)(S,{className:"file-block__size",variant:s.p2,children:(t=a.fileSize,t>1e5?"".concat((t/Math.pow(1024,2)).toFixed(1)," MB"):"".concat((t/1024).toFixed(1)," KB"))})]}):Object(h.jsx)(x,{className:"file-block__spinner",children:Object(h.jsx)(T,{})}),k.IMAGE.includes(a.fileType)&&Object(h.jsx)("img",{className:"file-block__image",src:a.fileLink,onClick:function(){return c&&c(a.fileLink)},onLoad:function(){return j(!0)}}),k.VIDEO.includes(a.fileType)&&Object(h.jsx)("video",{controls:!0,className:"file-block__video",onLoadedData:function(){return j(!0)},children:Object(h.jsx)("source",{src:a.fileLink,type:a.fileType})}),k.AUDIO.includes(a.fileType)&&Object(h.jsx)("audio",{controls:!0,className:"file-block__audio",onLoadedData:function(){return j(!0)},children:Object(h.jsx)("source",{src:a.fileLink,type:a.fileType})})]})}),P=(n(100),function(e){var t,n=e.isCurrentUserMessage,a=e.message,i=b()("message",(t={},Object(m.a)(t,"message_side_left",!n),Object(m.a)(t,"message_side_right",n),t)),c=a.text,o=a.file,l=Object(r.useCallback)((function(e){window.open(e)}),[]);return Object(h.jsxs)(x,{className:i,children:[o&&Object(h.jsx)(R,{file:o,handleImageClick:l}),c&&Object(h.jsx)(S,{variant:s.p1,className:"message__text",children:c})]})}),F=(n(101),function(e){var t=e.currentUsername,n=e.dialogMessages,a=Object(r.useRef)(null);return Object(r.useEffect)((function(){var e=a.current;e&&e.scroll(0,e.scrollHeight)}),[null===n||void 0===n?void 0:n.length]),Object(h.jsx)(h.Fragment,{children:(null===n||void 0===n?void 0:n.length)?Object(h.jsx)(x,{className:"messages-area",refBlock:a,children:n.map((function(e){return Object(h.jsx)(P,{message:e,isCurrentUserMessage:e.fromUser===t},e.createdAt)}))}):Object(h.jsx)(x,{className:"messages-area__no-messages-block",children:Object(h.jsx)(S,{variant:s.h4,color:y.primary,children:"\u0421\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u043f\u043e\u043a\u0430 \u043d\u0435\u0442..."})})})}),M=(n(102),function(e){var t,n=e.size,a=e.className,s=b()("logo",(t={},Object(m.a)(t,"logo_size_".concat(n),n),Object(m.a)(t,"".concat(a),a),t));return Object(h.jsx)(x,{className:s,children:Object(h.jsx)(C,{name:E.logo})})});!function(e){e.SCREEN_HOME="/",e.SCREEN_LOGIN="/login",e.SCREEN_SIGN_UP="/signup",e.SCREEN_CURRENT_DIALOG="/dialogs/:id",e.SCREEN_DIALOGS="/dialogs"}(A||(A={})),function(e){e.auth="auth",e.chat="chat"}(U||(U={}));var G,V,z,B=n(9),q=n(6),J=n(7),Y=new(function(){function e(){Object(q.a)(this,e),this.accessToken="accessToken",this.dialogs="dialogs"}return Object(J.a)(e,[{key:"clearAcessToken",value:function(){localStorage.removeItem(this.accessToken)}},{key:"clearDialogs",value:function(){localStorage.removeItem(this.dialogs)}},{key:"getAccessToken",value:function(){return localStorage.getItem(this.accessToken)}},{key:"getDialogsInfo",value:function(){var e=localStorage.getItem(this.dialogs);return e?JSON.parse(e):null}},{key:"setAccessToken",value:function(e){return localStorage.setItem(this.accessToken,e)}},{key:"setDialogsInfo",value:function(e,t){var n=this.getDialogsInfo();if(n){var a=n.find((function(e){return e.dialogId===t}));if(!(null===a||void 0===a?void 0:a.dialogId))return localStorage.setItem(this.dialogs,JSON.stringify([].concat(Object(B.a)(n),[e])));if(null===a||void 0===a?void 0:a.dialogId){var s=Object(B.a)(n.map((function(n){return n.dialogId===t?e:n})));return localStorage.setItem(this.dialogs,JSON.stringify(s))}}localStorage.setItem(this.dialogs,JSON.stringify([e]))}}]),e}());!function(e){e.button="button",e.reset="reset",e.submit="submit"}(G||(G={})),function(e){e.large="large",e.medium="medium",e.small="small"}(V||(V={})),function(e){e.primary="primary",e.outline="outline",e.notification="notification",e.icon="icon"}(z||(z={}));var K,W=n(8);!function(e){e.usersList="users_list",e.userData="user_data",e.sendMessage="send_message",e.sendUserJoinedInfo="user_joined",e.sendUserLogoutInfo="user_logout"}(K||(K={}));var Z,H="http://109.194.37.212",Q="".concat(H,":").concat("93","/api"),X="".concat("ws://109.194.37.212",":").concat("2346"),$=function(e){e(K.usersList)},ee=function(e){e(K.userData)},te=function(e,t){e(K.sendMessage,{message:t})},ne=function(e,t,n){e(K.sendUserJoinedInfo,{name:t,gender:n})};!function(e){e.LOADED="LOADED",e.ERROR="ERROR",e.NEVER="NEVER",e.PENDING="PENDING"}(Z||(Z={}));var ae,se,re=function(){function e(t){Object(q.a)(this,e),this.rootStore=void 0,this.genderList=[],this.genderListFetchError="",this.loadingState=Z.NEVER,this.rootStore=t,Object(W.d)(this)}return Object(J.a)(e,[{key:"setGenderList",value:function(e){this.genderListFetchError="",this.genderList=e}},{key:"setError",value:function(e){this.genderListFetchError=e}},{key:"fetchGenderList",value:w.a.mark((function e(){var t=this;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.genderList=[],this.loadingState=Z.PENDING,e.prev=2,e.next=5,fetch("".concat(Q,"/auth"),{method:"GET"}).then((function(e){200===e.status?e.json().then((function(e){Object(W.g)((function(){t.setGenderList(e.genders)}))})):e.text().then((function(e){Object(W.g)((function(){t.setError(e)}))}))}));case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),Object(W.g)((function(){t.setError(e.t0.message)}));case 10:return e.prev=10,this.loadingState=Z.LOADED,e.finish(10);case 13:case"end":return e.stop()}}),e,this,[[2,7,10,13]])}))}]),e}();!function(e){e.male="male",e.female="female",e.noGender="noGender"}(ae||(ae={})),function(e){e.large="large",e.medium="medium",e.small="small"}(se||(se={}));var ie,ce={companion:{username:"",gender:ae.noGender,lastSeen:""}},oe=function(){function e(t){Object(q.a)(this,e),this.rootStore=void 0,this.dialogsList=[],this.currentDialogInfo=ce,this.currentDialogId="",this.currentDialogError="",this.loadingState=Z.NEVER,this.rootStore=t,Object(W.d)(this)}return Object(J.a)(e,[{key:"getDialogInfo",value:function(e){return this.dialogsList.find((function(t){return t.dialogId===e}))}},{key:"setDialogList",value:function(){var e=Y.getDialogsInfo();this.dialogsList=e||[]}},{key:"setCurrentDialogInfo",value:function(e,t,n,a){this.currentDialogInfo.companion={username:e,lastSeen:t,gender:a},this.currentDialogId=n}},{key:"updateCurrentDialogMessages",value:function(e){var t=[e.fromUser,e.forUser].sort().toString(),n=this.rootStore.userStore.userInfo.username;if(e.forUser===n||e.fromUser===n){var a=this.getDialogInfo(t);if(!a){var s={dialogId:t,dialogMessages:[e]};this.dialogsList.push(s),Y.setDialogsInfo(s,t)}a&&(a.dialogMessages.push(e),Y.setDialogsInfo(a,t))}}},{key:"setError",value:function(e){this.currentDialogError=e}},{key:"clearError",value:function(){this.currentDialogError=""}},{key:"clearDialogs",value:function(){this.dialogsList=[]}},{key:"clearDialogStore",value:function(){this.clearDialogs(),this.clearError(),this.currentDialogId="",this.loadingState=Z.NEVER,this.currentDialogInfo=ce}},{key:"sendMessageFile",value:function(){var e=Object(L.a)(w.a.mark((function e(t,n){var a=this;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Object(W.g)((function(){a.loadingState=Z.PENDING})),e.prev=1,e.next=4,fetch("".concat(Q).concat(n),{method:"POST",body:t}).then((function(e){if(200===e.status)return a.currentDialogError&&Object(W.g)((function(){a.clearError()})),e.text();e.text().then((function(e){Object(W.g)((function(){console.log("error",e),a.setError(e)}))}))}));case 4:return e.abrupt("return",e.sent);case 7:e.prev=7,e.t0=e.catch(1),Object(W.g)((function(){var t=e.t0.message;a.setError("Failed to fetch"===t?"\u0412\u043e\u0437\u043d\u0438\u043a\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0435 \u0444\u0430\u0439\u043b\u0430, \u043f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0441\u043d\u043e\u0432\u0430...":t)}));case 10:return e.prev=10,Object(W.g)((function(){a.loadingState=Z.LOADED})),e.finish(10);case 13:case"end":return e.stop()}}),e,null,[[1,7,10,13]])})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),le=function(){function e(t){Object(q.a)(this,e),this.rootStore=void 0,this.userList=[],this.loadingState=Z.NEVER,this.rootStore=t,Object(W.d)(this)}return Object(J.a)(e,[{key:"clearUserListStore",value:function(){this.userList=[],this.loadingState=Z.NEVER}},{key:"setUserList",value:function(e){var t=this,n=this.rootStore.userStore.userInfo.username,a=e.filter((function(e){return e.name!==n}));Object(W.g)((function(){t.userList=a,t.loadingState=Z.LOADED}))}},{key:"updateUserList",value:function(e){var t=this,n=this.rootStore.userStore.userInfo.username;Object(W.g)((function(){n===e.name||t.userList.find((function(t){return t.name===e.name}))||t.userList.push(e)}))}}]),e}(),ue=Y.getAccessToken(),de=function(){function e(t){Object(q.a)(this,e),this.rootStore=void 0,this.userInfo={username:"",gender:"",isUserAuthenticate:!!ue},this.tokens={accessToken:ue||""},this.loadingState=Z.NEVER,this.userAuthDataError="",Object(W.d)(this),this.rootStore=t}return Object(J.a)(e,[{key:"setCurrentUserInfo",value:function(e){var t=e.name,n=e.gender;this.userInfo={username:t,gender:n,isUserAuthenticate:!0}}},{key:"setAccessToken",value:function(e){this.tokens={accessToken:e},this.userInfo.isUserAuthenticate=!0,Y.setAccessToken(e)}},{key:"clearUserInfo",value:function(){Y.clearAcessToken(),this.userInfo={username:"",gender:"",isUserAuthenticate:!1},this.tokens.accessToken=""}},{key:"setError",value:function(e){this.userAuthDataError=e}},{key:"clearError",value:function(){this.userAuthDataError=""}},{key:"setLoadingState",value:function(e){this.loadingState=e}},{key:"sendUserAuthData",value:function(){var e=Object(L.a)(w.a.mark((function e(t,n){var a=this;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.loadingState=Z.PENDING,e.prev=1,e.next=4,fetch("".concat(Q).concat(n),{method:"POST",body:t}).then((function(e){if(200===e.status)return a.userAuthDataError&&Object(W.g)((function(){a.clearError()})),e.json();e.text().then((function(e){Object(W.g)((function(){a.setError(e)}))}))}));case 4:return e.abrupt("return",e.sent);case 7:e.prev=7,e.t0=e.catch(1),Object(W.g)((function(){a.setError(e.t0.message)}));case 10:return e.prev=10,this.loadingState=Z.LOADED,e.finish(10);case 13:case"end":return e.stop()}}),e,this,[[1,7,10,13]])})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),fe=Object(r.createContext)(new function e(){Object(q.a)(this,e),this.userStore=new de(this),this.userListStore=new le(this),this.dialogStore=new oe(this),this.genderListStore=new re(this),this.userStore=new de(this),this.genderListStore=new re(this),this.dialogStore=new oe(this),this.genderListStore=new re(this)}),me=(n(103),function(e){var t=e.handleVisiblePopup,n=Object(u.g)(),a=Object(r.useContext)(fe),s=a.dialogStore,i=a.userStore,c=a.userListStore;return Object(h.jsx)(x,{className:"user-menu-popup",children:Object(h.jsxs)("ul",{className:"user-menu-popup__list",children:[Object(h.jsx)("li",{className:"user-menu-popup__item",children:Object(h.jsx)(g,{type:G.button,onClick:function(){t(),Y.clearDialogs(),s.clearDialogs()},className:"user-menu-popup__button",children:"\u041e\u0447\u0438\u0441\u0442\u0438\u0442\u044c \u0447\u0430\u0442\u044b"})}),Object(h.jsx)("li",{className:"user-menu-popup__item",children:Object(h.jsx)(g,{type:G.button,onClick:function(){t(),i.clearUserInfo(),c.clearUserListStore(),s.clearDialogStore(),n.push(A.SCREEN_LOGIN)},className:"user-menu-popup__button",children:"\u0412\u044b\u0439\u0442\u0438"})})]})})}),je=(n(104),function(e){var t=e.iconName,n=e.type,a=e.color,s=e.isDisabled,r=e.className,i=e.arialabel,c=e.onClick;return Object(h.jsx)(g,{type:n,size:V.small,isDisabled:s,onClick:c,className:r,variant:z.icon,arialabel:i,children:Object(h.jsx)(C,{name:t,color:a,className:"button__icon"})})});!function(e){e.large="large",e.medium="medium"}(ie||(ie={}));n(105);var be,he,ge,pe=i.a.memo((function(e){var t,n=e.isLoginPage,a=e.isChatPage,i=Object(r.useState)(!1),c=Object(f.a)(i,2),o=c[0],u=c[1],d=Object(r.useCallback)((function(){u(!o)}),[o]),j=b()("header",(t={},Object(m.a)(t,"auth-page__header",n),Object(m.a)(t,"chat-page__header",a),t));return Object(h.jsxs)("header",{className:j,children:[a?Object(h.jsx)(l.b,{to:a?A.SCREEN_DIALOGS:A.SCREEN_LOGIN,children:Object(h.jsx)(M,{size:ie.large,className:"header__logo"})}):Object(h.jsx)(M,{size:ie.large,className:"header__logo"}),n?Object(h.jsxs)(S,{variant:s.h1,className:"header__text",children:["Wellcome to",Object(h.jsxs)(S,{variant:s.span,color:y.primary,children:[" ","Chatty"]}),Object(h.jsx)(S,{variant:s.span,color:y.mediumBlue,children:"!"})]}):Object(h.jsxs)(x,{className:"header__info",children:[Object(h.jsx)(je,{className:"header__button",type:G.button,color:y.primary,iconName:E.userIcon,onClick:d}),Object(h.jsx)(x,{className:b()("header__user-menu-popup",{"header__user-menu-popup_active":o}),children:Object(h.jsx)(me,{handleVisiblePopup:d})})]})]})})),Oe=n(12),ve=n(30),xe=n(16),_e=(n(204),function(e){var t,n=e.htmlFor,a=e.labelText,s=e.errorText,r=e.children,i=e.className,c=b()("label",(t={},Object(m.a)(t,"".concat(i),i),Object(m.a)(t,"label_notification_error",s),t));return Object(h.jsxs)("label",{htmlFor:n,className:c,children:[s||a,r]})});!function(e){e.text="text",e.email="email",e.password="password",e.file="file",e.textarea="textarea",e.select="select"}(be||(be={})),function(e){e.login="login",e.password="password",e.passwordConfirm="passwordConfirm",e.nickname="nickname",e.captcha="captcha",e.gender="gender",e.files="files",e.messageText="messageText"}(he||(he={})),function(e){e.large="large",e.medium="medium"}(ge||(ge={}));n(205);var Ne,Se=function(e){var t=e.id,n=e.field,a=e.uniqueKey,s=e.errorText,r=e.className,i=e.handleFileInputChange,c=b()("file-input",Object(m.a)({},"".concat(r),r));return Object(h.jsxs)(x,{className:c,children:[Object(h.jsxs)(_e,{htmlFor:he.files,className:"file-input__label",children:[Object(h.jsx)(C,{name:E.addFile,className:"file-input__icon"}),Object(h.jsx)("input",Object(p.a)(Object(p.a)({type:be.file,id:t},n),{},{value:n.value.filename,onChange:function(e){i(e,n.onChange)}}),a)]}),Object(h.jsx)(_e,{errorText:s,className:"file-input__label_error"})]})},Ee=(n(206),function(e){var t,n=e.type,a=e.placeholder,s=void 0===a?"":a,r=e.labelText,i=e.errorText,c=e.className,o=e.isRequired,l=e.isDisabled,u=e.size,d=e.field,f=e.isAvailableAutoComplete,j=void 0===f||f,g=b()("form-field",(t={},Object(m.a)(t,"".concat(c),c),Object(m.a)(t,"form-field_size_".concat(u),u),t)),O=b()("form-field__input",Object(m.a)({},"form-field__input_notification_error",i));return Object(h.jsxs)(x,{className:g,children:[Object(h.jsx)(_e,{htmlFor:d.name,labelText:r,className:"form-field__label"}),Object(h.jsxs)(x,{className:"form-field__inner",children:[n===be.textarea?Object(h.jsx)("textarea",Object(p.a)({required:o,className:"form-field__textarea",placeholder:s,id:d.name},d)):Object(h.jsx)("input",Object(p.a)({autoComplete:j?"on":"off",className:O,id:d.name,placeholder:s,type:n,disabled:l},d)),i&&Object(h.jsx)(C,{className:"form-field__icon",color:y.error,name:E.inputError})]}),i&&Object(h.jsx)(_e,{htmlFor:d.name,errorText:i,className:"form-field__label_notification_error"})]})}),ye=(n(207),function(e){var t=e.previewFileState,n=e.handleDeletePreviewFile,a=t.isVisiblePreviewFile,s=t.fileInfo,r=t.handleSetIsVisiblePreview;return Object(h.jsx)(x,{className:b()("preview",{preview_active:a}),children:Object(h.jsxs)(x,{className:"preview__wrapper",flex:!0,children:[Object(h.jsx)(R,{file:s,className:"preview__file"}),Object(h.jsxs)(x,{className:"preview__buttons",children:[Object(h.jsx)(je,{className:"preview__button",type:G.button,iconName:E.closeCircleIcon,color:y.primary,onClick:r}),Object(h.jsx)(je,{className:"preview__button",type:G.button,iconName:E.deleteIcon,color:y.error,onClick:n})]})]})})}),ke={fileLink:"",fileType:"",fileSize:0,fileName:""},Ie=function(e){var t=e.size>=2097152,n=![].concat(Object(B.a)(k.VIDEO),Object(B.a)(k.AUDIO),Object(B.a)(k.IMAGE)).includes(e.type);return{isValid:!t&&!n,isTypeError:n,isSizeError:t}},we=(n(208),xe.a().shape({messageText:xe.c()})),Le=function(e){var t,n=e.WSAction,a=e.dialogStore,i=e.currentUsername,c=e.isFileLoading,o=function(){var e=Object(r.useState)(!1),t=Object(f.a)(e,2),n=t[0],a=t[1],s=Object(r.useState)(ke),i=Object(f.a)(s,2),c=i[0],o=i[1],l=Object(r.useState)(!1),u=Object(f.a)(l,2),d=u[0],m=u[1],j=Object(r.useState)(Date.now()),b=Object(f.a)(j,2),h=b[0],g=b[1],p=Object(r.useCallback)((function(e){var t=new FileReader;m(!1),t.onload=function(){o({fileLink:t.result,fileType:e.type,fileSize:e.size,fileName:e.name}),a(!0),m(!0)},t.readAsDataURL(e)}),[]),O=Object(r.useCallback)((function(){m(!d)}),[d]),v=Object(r.useCallback)((function(){o(ke),m(!1)}),[]),x=Object(r.useCallback)((function(){g(Date.now())}),[]);return[{fileInfo:c,isLoaded:n,isVisiblePreviewFile:d,uniqueKeyInput:h,setFileInfo:o,handleSetIsVisiblePreview:O,handleDeleteFile:v,handleResetUniqueKey:x},p]}(),l=Object(f.a)(o,2),u=l[0],d=l[1],m=Object(r.useRef)({text:"",fromUser:"",forUser:"",file:{fileLink:"",fileType:"",fileSize:0,fileName:""},createdAt:null}),j=Object(Oe.e)({mode:"onChange",resolver:Object(ve.a)(we),defaultValues:{messageText:"",files:[]}}),g=j.handleSubmit,p=j.control,O=j.reset,v=j.clearErrors,_=j.setError,N=j.formState,k=N.errors,I=N.isValid,D=N.isSubmitSuccessful,C=(null===(t=k.files)||void 0===t?void 0:t.message)||a.currentDialogError,A=Object(r.useCallback)((function(){u.handleDeleteFile(),u.handleResetUniqueKey(),O({files:[]})}),[u,O]),U=function(){var e=Object(L.a)(w.a.mark((function e(t){var s,r,c,o,l,u,d;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=new FormData,m.current={text:t.messageText,fromUser:i,forUser:a.currentDialogInfo.companion.username,createdAt:Date.now()},!(null===(s=t.files)||void 0===s?void 0:s.name)){e.next=9;break}return c=t.files,o=c.name,l=c.size,u=c.type,r.append("0",t.files,t.files.name),e.next=7,a.sendMessageFile(r,"/upload");case 7:(d=e.sent)&&(m.current.file={fileLink:"".concat(H,":").concat("93").concat(d),fileType:u,fileSize:l,fileName:o});case 9:(m.current.text||m.current.file)&&n.sendMessage("'".concat(JSON.stringify(m.current),"'"));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),T=Object(r.useCallback)((function(e,t){var n;if(null===(n=e.target.files)||void 0===n?void 0:n.length){var a=e.target.files[0];Ie(a).isValid&&(d(a),t(a)),Ie(a).isSizeError&&_("files",{type:"fileError",message:"\u0420\u0430\u0437\u043c\u0435\u0440 \u0444\u0430\u0439\u043b\u0430 \u0434\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c \u043c\u0435\u043d\u044c\u0448\u0435 2 \u043c\u0431"}),Ie(a).isTypeError&&_("files",{type:"fileError",message:"\u0414\u0430\u043d\u043d\u044b\u0439 \u0442\u0438\u043f \u043d\u0435 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044f"})}}),[d,_]);return Object(r.useEffect)((function(){D&&(A(),O({files:[],messageText:""}),m.current={text:"",fromUser:"",forUser:"",createdAt:null})}),[D,u,A,O]),Object(r.useEffect)((function(){C&&setTimeout((function(){v("files"),a.clearError(),u.handleResetUniqueKey()}),1e3)}),[v,u,C,a]),Object(h.jsxs)("form",{className:"message-form",onSubmit:g(U),children:[Object(h.jsx)(x,{className:"message-form__preview-block",children:Object(h.jsx)(ye,{previewFileState:u,handleDeletePreviewFile:A})}),u.fileInfo.fileName&&Object(h.jsx)(je,{className:b()("message-form__preview-button",{"message-form__preview-button_active":!u.isVisiblePreviewFile}),iconName:E.arrowDown,type:G.button,onClick:u.handleSetIsVisiblePreview}),Object(h.jsxs)(x,{flex:!0,align:"center",className:"message-form__inner",children:[Object(h.jsx)(Oe.a,{name:he.files,control:p,render:function(e){var t=e.field;return Object(h.jsx)(Se,{id:he.files,className:"message-form__file-input",field:t,handleFileInputChange:T,uniqueKey:u.uniqueKeyInput,errorText:C})}}),Object(h.jsx)(Oe.a,{name:he.messageText,control:p,render:function(e){var t=e.field;return Object(h.jsx)(Ee,{placeholder:"Write something...",type:be.textarea,field:t})}}),Object(h.jsx)(S,{variant:s.span,className:b()("message-form__tooltip",{"message-form__tooltip_active":c}),children:"\u0418\u0434\u0435\u0442 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0430 \u0444\u0430\u0439\u043b\u0430..."}),Object(h.jsx)(je,{iconName:c?E.spinnerCircle:E.sendMessage,type:G.submit,color:y.primary,className:"message-form__button",isDisabled:!I||c})]})]})},De=function(e){return e===ae.male?E.maleAvatar:e===ae.female?E.femaleAvatar:E.noUserAvatar},Ce=(n(209),function(e){var t,n=e.size,a=e.gender,s=e.className,r=b()("avatar",(t={},Object(m.a)(t,"avatar_size_".concat(n),n),Object(m.a)(t,"".concat(s),s),t));return Object(h.jsx)(C,{className:r,name:De(a)})}),Ae=(n(210),function(e){var t=e.username,n=e.userStatus,a=e.gender,r=e.className,i=b()("user-status",Object(m.a)({},"".concat(r),r));return Object(h.jsxs)(x,{flex:!0,row:!0,className:i,children:[Object(h.jsx)(Ce,{size:se.small,gender:a,className:"user-status__avatar"}),Object(h.jsxs)(x,{flex:!0,column:!0,children:[Object(h.jsx)(S,{variant:s.h3,className:"user-status__username",children:t}),Object(h.jsx)(S,{variant:s.p1,className:"user-status__last-seen",children:n})]})]})}),Ue=(n(211),function(e){var t=e.isVisibleUserList,n=e.dialogInfo,a=e.handleVisibleUserList;return Object(h.jsxs)(x,{flex:!0,align:"center",className:"status-bar",children:[Object(h.jsx)(je,{iconName:t?E.closeIcon:E.userList,type:G.button,color:y.primary,onClick:a,className:b()("status-bar__user-list-icon",Object(m.a)({},"status-bar__user-list-icon_transform",t))}),Object(h.jsx)(je,{iconName:E.arrowLeft,type:G.button,color:y.primary,onClick:function(){return history.back()},className:"status-bar__back-icon"}),Object(h.jsx)(Ae,{className:"status-bar__user-status",username:n.username,userStatus:n.lastSeen,gender:n.gender})]})}),Te=function(e){var t,n=null===e||void 0===e||null===(t=e.file)||void 0===t?void 0:t.fileType;return n?k.VIDEO.includes(n)?"Video file":k.AUDIO.includes(n)?"Audio file":"Image file":null===e||void 0===e?void 0:e.text},Re=(n(212),i.a.memo((function(e){var t=e.name,n=e.gender,a=e.id,r=e.lastMessage,i=e.setDialogInfo,c=e.handleVisibleUserList,o=(null===r||void 0===r?void 0:r.forUser)===t;return Object(h.jsxs)(l.b,{to:"".concat(A.SCREEN_DIALOGS,"/").concat(a),className:"user-list__link",activeClassName:"user-list__link_active",onClick:function(){c(),i(t,"Last seen recently",n)},children:[Object(h.jsx)(Ce,{size:se.medium,gender:n,className:"link__avatar"}),Object(h.jsxs)(x,{className:"link__info",children:[Object(h.jsx)(S,{variant:s.h4,className:"link__username",children:t}),Object(h.jsxs)(S,{variant:s.p2,className:"link__last-message",children:[o&&Object(h.jsxs)(S,{variant:s.span,color:y.primary,children:["You:"," "]}),Te(r)]})]})]})}))),Pe=(n(213),function(e){var t=e.className,n=b()("no-user-block",Object(m.a)({},"".concat(t),t));return Object(h.jsxs)("div",{className:n,children:[Object(h.jsx)(Ce,{size:se.large,gender:ae.noGender}),Object(h.jsx)(S,{variant:s.p2,className:"no-user-block__text",children:"There is no other users yet"})]})}),Fe=(n(214),Object(d.a)((function(e){var t=e.isVisibleUserList,n=e.users,a=e.isLoaded,s=e.setDialogInfo,r=e.getLastMessage,i=e.handleVisibleUserList,c=b()("user-list",Object(m.a)({},"user-list_active",t));return Object(h.jsx)("div",{className:c,children:a?n.length?n.map((function(e,t){return Object(h.jsx)(Re,{handleVisibleUserList:i,setDialogInfo:s,id:"".concat(e.name,"_").concat(t),name:e.name,gender:e.gender,lastMessage:r(e.name),isCurrentUserLastMessage:e.isCurrentUserLastMessage},"".concat(e.name,"_").concat(t))})):Object(h.jsx)(Pe,{className:"user-list__no-user-block"}):Object(h.jsx)(T,{className:"user-list__spinner"})})}))),Me=(n(215),function(e){var t=e.notificationText,n=(e.isError,Object(r.useContext)(fe).userStore);return Object(h.jsx)(x,{className:"modal",children:Object(h.jsxs)(x,{className:"modal__wrapper",children:[Object(h.jsx)(S,{variant:s.h3,className:"modal__header-text",children:"\u041f\u043e\u0445\u043e\u0436\u0435 \u0447\u0442\u043e-\u0442\u043e \u043f\u043e\u0448\u043b\u043e \u043d\u0435 \u0442\u0430\u043a..."}),Object(h.jsxs)(S,{variant:s.p1,className:"modal__info-text",children:["\u041f\u043e\u043f\u044b\u0442\u043a\u0430 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f \u0437\u0430\u0432\u0435\u0440\u0448\u0438\u043b\u0430\u0441\u044c \u043d\u0435\u0443\u0434\u0430\u0447\u043d\u043e, \u0442\u0435\u043a\u0441\u0442 \u043e\u0448\u0438\u0431\u043a\u0438 :",Object(h.jsx)(S,{variant:s.span,className:"modal__error-text",children:"error"===t?"\u041f\u0440\u043e\u0432\u0435\u0440\u044c\u0442\u0435 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 \u043a \u0441\u0435\u0442\u0438":t})]}),Object(h.jsx)(S,{variant:s.p1,className:"modal__info-text",children:"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u0435\u0440\u043d\u0438\u0442\u0435\u0441\u044c \u043d\u0430 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443 \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u0438 \u0438 \u043f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0432\u043e\u0439\u0442\u0438 \u0441\u043d\u043e\u0432\u0430."}),Object(h.jsx)(g,{type:G.button,variant:z.notification,className:"modal__button",onClick:function(){n.clearUserInfo()},children:"\u041d\u0430 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443 \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u0438"})]})})}),Ge=(n(216),function(e){var t=e.children,n=e.page,a=b()("main-container",Object(m.a)({},"".concat(n,"-page__main-container"),n));return Object(h.jsx)("main",{className:a,children:t})});!function(e){e[e.SIZE_MOBILE_L=425]="SIZE_MOBILE_L",e[e.SIZE_TABLET_S=550]="SIZE_TABLET_S"}(Ne||(Ne={}));n(217);var Ve,ze=function(e){var t=e.isLoadedDialogInfo,n=e.header,a=e.userList,s=e.statusBar,i=e.dialog,c=e.messageForm,o=e.notificationButton,l=e.errorModal,d=e.spinner,m=function(){var e=Object(r.useState)({width:0}),t=Object(f.a)(e,2),n=t[0],a=t[1];return Object(r.useEffect)((function(){function e(){a({width:window.innerWidth})}return window.addEventListener("resize",e),e(),function(){return window.removeEventListener("resize",e)}}),[]),n}(),j=Object(u.i)("".concat(A.SCREEN_CURRENT_DIALOG)),b=Object(u.i)("".concat(A.SCREEN_DIALOGS));return Object(h.jsxs)(Ge,{page:U.chat,children:[l,(m.width>Ne.SIZE_TABLET_S||(null===b||void 0===b?void 0:b.isExact))&&n,Object(h.jsxs)("main",{className:"chat-page__inner",children:[(m.width>Ne.SIZE_TABLET_S||(null===b||void 0===b?void 0:b.isExact))&&a,Object(h.jsx)(x,{className:"chat-page__dialog",children:t?j?Object(h.jsxs)(h.Fragment,{children:[s,i,c]}):o:Object(h.jsx)(x,{className:"chat-page__spinner",children:d})})]})]})},Be=["type"],qe=Object(d.a)((function(){var e=Object(r.useState)(!1),t=Object(f.a)(e,2),n=t[0],a=t[1],s=Object(u.h)(),c=Object(u.g)(),o=function(e){var t=Object(r.useContext)(fe),n=t.userStore,a=t.userListStore,s=t.dialogStore,i=Object(r.useRef)(),c=Object(r.useState)(!1),o=Object(f.a)(c,2),l=o[0],u=o[1],d=Object(r.useState)(""),m=Object(f.a)(d,2),j=m[0],b=m[1],h=Object(r.useState)(),g=Object(f.a)(h,2),v=g[0],x=g[1],_=Object(r.useState)(!1),N=Object(f.a)(_,2),S=N[0],E=N[1],y=n.tokens.accessToken,k="/?type=".concat(e,"&ws_id=");Object(r.useEffect)((function(){return y&&(i.current=new WebSocket("".concat(X).concat(k).concat(y))),function(){var e,t;null===(e=i.current)||void 0===e||e.send("closed1"),E(!0),null===(t=i.current)||void 0===t||t.close()}}),[y,k]),Object(r.useEffect)((function(){i.current&&(i.current.onopen=function(){u(!0)},i.current.onerror=function(e){b(e.type)},i.current.onclose=function(){var e,t;null===(e=i.current)||void 0===e||e.send("closed2"),E(!0),null===(t=i.current)||void 0===t||t.close()},i.current&&(i.current.onmessage=function(e){if(e.data.includes("Get param 'ws_id' - is wrong! Please relogin!"))return b(e.data);var t=e.data.replaceAll("'",""),r=JSON.parse(t),i=r.type,c=Object(O.a)(r,Be);i===K.sendMessage&&s.updateCurrentDialogMessages(JSON.parse(c.data.message)),i===K.usersList&&a.setUserList(c.data),i===K.userData&&n.setCurrentUserInfo(c.data),i===K.sendUserJoinedInfo&&(a.userList.find((function(e){return e.name===c.data.name}))||a.updateUserList(c.data)),x(c.data)}))}),[a,n,s]);var I=function(e,t){var n,a;return e===K.sendMessage||e===K.sendUserJoinedInfo||e===K.sendUserLogoutInfo?null===(a=i.current)||void 0===a?void 0:a.send("'".concat(JSON.stringify({type:e,data:t}),"'")):null===(n=i.current)||void 0===n?void 0:n.send(JSON.stringify(Object(p.a)({type:e},t)))};return[{isOpen:l,error:j,result:v,isClosed:S},Object(r.useMemo)((function(){return{fetchUserList:function(){return $(I)},fetchUserData:function(){return ee(I)},sendMessage:function(e){return te(I,e)},sendUserJoinedInfo:function(e,t){return ne(I,e,t)}}}),[])]}("general_channel"),l=Object(f.a)(o,2),d=l[0],m=l[1],j=Object(r.useContext)(fe),b=j.userListStore,v=j.dialogStore,x=j.userStore.userInfo,_=x.username,N=x.gender,S=v.getDialogInfo(v.currentDialogId),E=i.a.useCallback((function(){a(!n)}),[n]),y=i.a.useCallback((function(e,t,n){var a=[_,e].sort().toString();v.setCurrentDialogInfo(e,t,a,n)}),[v,_]),k=i.a.useCallback((function(e){var t,n=[_,e].sort().toString(),a=v.getDialogInfo(n);if(a)return a.dialogMessages[(null===(t=a.dialogMessages)||void 0===t?void 0:t.length)-1]}),[_,v]);return Object(r.useEffect)((function(){var e=s.id;if(e&&b.loadingState===Z.LOADED){var t=b.userList.find((function(t){return t.name===e.slice(0,e.lastIndexOf("_"))}));(null===t||void 0===t?void 0:t.name)?y(t.name,"Last seen recently",t.gender):c.push(A.SCREEN_DIALOGS)}}),[s,y,c,b.loadingState,b.userList]),Object(r.useEffect)((function(){d.isOpen&&(m.fetchUserData(),m.fetchUserList(),v.setDialogList())}),[m,d.isOpen,v]),Object(r.useEffect)((function(){d.isOpen&&_&&m.sendUserJoinedInfo(_,N)}),[m,d.isOpen,_,N]),Object(h.jsx)(h.Fragment,{children:Object(h.jsx)(ze,{isLoadedDialogInfo:"LOADED"===b.loadingState,errorModal:d.error?Object(h.jsx)(Me,{isError:!0,notificationText:d.error}):void 0,header:Object(h.jsx)(pe,{isChatPage:!0}),userList:Object(h.jsx)(Fe,{getLastMessage:k,setDialogInfo:y,users:b.userList,isLoaded:b.loadingState===Z.LOADED,handleVisibleUserList:E,isVisibleUserList:n}),statusBar:Object(h.jsx)(Ue,{isVisibleUserList:n,handleVisibleUserList:E,dialogInfo:v.currentDialogInfo.companion}),dialog:Object(h.jsx)(F,{dialogMessages:null===S||void 0===S?void 0:S.dialogMessages,currentUsername:_}),messageForm:Object(h.jsx)(Le,{dialogStore:v,currentUsername:_,WSAction:m,isFileLoading:v.loadingState===Z.PENDING}),spinner:Object(h.jsx)(T,{}),notificationButton:Object(h.jsx)(g,{variant:z.notification,type:G.button,className:"chat-page__button_notification",onClick:E,children:"Select a chat to start messaging"})})})})),Je={fetchCaptcha:function(){var e=Object(L.a)(w.a.mark((function e(t,n){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n(!1),t(""),e.prev=2,e.next=5,fetch("".concat(Q,"/auth/captcha?t=").concat(Date.now())).then((function(e){200===e.status&&t(e.url)}));case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),t("");case 10:return e.prev=10,n(!0),e.finish(10);case 13:case"end":return e.stop()}}),e,null,[[2,7,10,13]])})));return function(t,n){return e.apply(this,arguments)}}()},Ye=(n(218),i.a.memo((function(){var e=Object(r.useState)(""),t=Object(f.a)(e,2),n=t[0],a=t[1],s=Object(r.useState)(!1),i=Object(f.a)(s,2),c=i[0],o=i[1],l=Object(r.useCallback)((function(){Je.fetchCaptcha(a,o)}),[]);return Object(r.useEffect)((function(){l()}),[l]),Object(h.jsxs)(x,{flex:!0,align:"center",className:"captcha-block",children:[c?n?Object(h.jsx)("img",{src:"".concat(n),alt:"captcha"}):Object(h.jsx)("span",{children:"Failed to fetch captcha"}):Object(h.jsx)(T,{className:"captcha-block__spinner"}),Object(h.jsx)(je,{className:"captcha-block__button",iconName:E.updateIcon,color:y.primary,type:G.button,onClick:l,arialabel:"Refresh captcha"})]})})));!function(e){e.login="login",e.password="password",e.passwordConfirm="password_confirm",e.nickname="name",e.gender="gender_id",e.captcha="captcha"}(Ve||(Ve={}));var Ke=function(e){var t=new FormData;return t.append(Ve.login,e.login),t.append(Ve.password,e.password),t.append(Ve.captcha,e.captcha),e.passwordConfirm&&t.append(Ve.passwordConfirm,e.passwordConfirm),e.nickname&&t.append(Ve.nickname,e.nickname),e.gender&&t.append(Ve.gender,e.gender),t},We=function(e,t){for(var n in Ve)e.match(Ve.gender)&&t("gender",{message:"Something wrong with this field"}),e.match(Ve.password)&&t("passwordConfirm",{message:"Something wrong with this field"}),e.match(Ve.nickname)&&t("nickname",{message:"Your name must be less than 50 letters"}),e.match(n)&&t(n,{message:e})},Ze=(n(219),xe.a().shape({login:xe.c().min(2,"Your name must contain at least 2 letters").max(25,"Your name must be less than 50 letters").required("Please input your name"),password:xe.c().required("Please input your password"),captcha:xe.c().min(5,"Min 5 symbols").max(5,"Max 5 symbols").required("Please input captcha")})),He=Object(d.a)((function(){var e=i.a.useContext(fe).userStore,t=Object(Oe.e)({mode:"onChange",resolver:Object(ve.a)(Ze),defaultValues:{login:"",password:"",captcha:""}}),n=t.handleSubmit,a=t.control,c=t.setError,o=t.formState,l=o.errors,u=o.isValid,d=o.isSubmitSuccessful,f=function(){var t=Object(L.a)(w.a.mark((function t(n){var a;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.sendUserAuthData(Ke(n),"/auth/login");case 2:(a=t.sent)&&e.setAccessToken(a);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return Object(r.useEffect)((function(){e.userAuthDataError&&d&&We(e.userAuthDataError,c)}),[c,e,d,e.userAuthDataError]),Object(h.jsxs)(x,{className:"form-login",children:[Object(h.jsx)(S,{className:"form-login__text",variant:s.h2,children:"Please, autorize yourself"}),Object(h.jsxs)("form",{onSubmit:n(f),children:[Object(h.jsx)(Oe.a,{name:he.login,control:a,render:function(e){var t,n=e.field;return Object(h.jsx)(Ee,{placeholder:"User name",type:be.text,labelText:"User name",className:"form-login__input",field:n,errorText:null===(t=l.login)||void 0===t?void 0:t.message})}}),Object(h.jsx)(Oe.a,{name:he.password,control:a,render:function(e){var t,n=e.field;return Object(h.jsx)(Ee,{placeholder:"Input password",type:be.password,labelText:"Password",className:"form-login__input",field:n,errorText:null===(t=l.password)||void 0===t?void 0:t.message})}}),Object(h.jsxs)(x,{flex:!0,className:"form-login__security-code",children:[Object(h.jsx)(Oe.a,{name:he.captcha,control:a,render:function(e){var t,n=e.field;return Object(h.jsx)(Ee,{placeholder:"Security code",type:be.text,labelText:"Security code",className:"form-login__input",field:n,size:ge.medium,errorText:null===(t=l.captcha)||void 0===t?void 0:t.message})}}),Object(h.jsx)(Ye,{})]}),Object(h.jsxs)(x,{flex:!0,className:"form-login__buttons",children:[Object(h.jsx)(g,{className:"form-login__button",variant:z.primary,size:V.medium,type:G.submit,isDisabled:!u,children:"Log in"}),Object(h.jsx)(g,{className:"form-login__button",variant:z.outline,size:V.medium,type:G.button,isNavLink:!0,path:A.SCREEN_SIGN_UP,children:"Registration"})]})]})]})})),Qe=(n(220),function(e){var t=e.labelText,n=e.error,a=e.className,i=e.options,c=e.setValue,o=e.clearErrors,l=Object(r.useState)(!1),u=Object(f.a)(l,2),d=u[0],j=u[1],g=Object(r.useState)(""),p=Object(f.a)(g,2),O=p[0],v=p[1],_=b()("select__list",{" select__list_active":d});return Object(h.jsxs)(x,{className:"form-field",children:[Object(h.jsx)(_e,{labelText:t,className:"form-field__label"}),Object(h.jsxs)(x,{className:b()("select",Object(m.a)({" select_notification_error":n},"".concat(a),a)),onClick:function(){return j(!d)},children:[Object(h.jsx)(S,{variant:s.p3,className:"select__placeholder",color:O?void 0:y.darkGrey,children:O||"Your gender"}),Object(h.jsx)(C,{className:b()("select__button",{" select__button_active":d}),name:E.arrowDown,color:y.primary}),Object(h.jsx)("ul",{className:_,children:i.map((function(e){return Object(h.jsx)("li",{className:"select__item",onClick:function(){c("gender",e.id,{shouldValidate:!0}),v(e.gender),j(!d),o(["gender"])},children:Object(h.jsx)(S,{variant:s.p3,children:e.gender})},e.id)}))})]}),n&&Object(h.jsx)(_e,{errorText:n,className:"form-field__label_notification_error"})]})}),Xe=(n(221),xe.a().shape({login:xe.c().min(2,"Your name must contain at least 2 letters").max(50,"Your name must be less than 50 letters").required("Please input your name"),password:xe.c().required("Please input password"),passwordConfirm:xe.c().required("Please confirm password").oneOf([xe.b("password"),null],"Passwords must match"),nickname:xe.c().min(2,"Your name must contain at least 2 letters").max(50,"Your name must be less than 50 letters").required("Please input your name"),gender:xe.c().required("Please choose your gender").typeError("Choose your gender"),captcha:xe.c().min(5,"Min 5 symbols").max(5,"Max 5 symbols").required("Please input captcha")})),$e=Object(d.a)((function(){var e,t=Object(u.g)(),n=Object(r.useContext)(fe),a=n.genderListStore,i=n.userStore,c=Object(r.useCallback)((function(){a.fetchGenderList()}),[a]),o=Object(Oe.e)({mode:"onChange",resolver:Object(ve.a)(Xe),defaultValues:{login:"",password:"",passwordConfirm:"",nickname:"",gender:"",captcha:""}}),l=o.handleSubmit,d=o.control,f=o.setValue,m=o.setError,j=o.clearErrors,b=o.formState,p=b.errors,O=b.isValid,v=b.isSubmitSuccessful,_=function(){var e=Object(L.a)(w.a.mark((function e(n){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.sendUserAuthData(Ke(n),"/auth/register");case 2:e.sent&&t.push(A.SCREEN_LOGIN);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(r.useEffect)((function(){i.userAuthDataError&&v&&We(i.userAuthDataError,m)}),[m,i.userAuthDataError,v]),Object(h.jsxs)(x,{className:"form-sign-up",children:[Object(h.jsx)(S,{className:"form-sign-up__text",variant:s.h2,children:"Registration"}),Object(h.jsxs)("form",{onSubmit:l(_),children:[Object(h.jsx)(Oe.a,{name:he.login,control:d,render:function(e){var t,n=e.field;return Object(h.jsx)(Ee,{placeholder:"Input user name",type:be.text,labelText:"Create user name",className:"form-sign-up__input",field:n,size:ge.large,errorText:null===(t=p.login)||void 0===t?void 0:t.message})}}),Object(h.jsx)(Oe.a,{name:he.password,control:d,render:function(e){var t,n=e.field;return Object(h.jsx)(Ee,{placeholder:"Input password",type:be.text,labelText:"Create password",className:"form-sign-up__input",field:n,size:ge.large,errorText:null===(t=p.password)||void 0===t?void 0:t.message})}}),Object(h.jsx)(Oe.a,{name:he.passwordConfirm,control:d,render:function(e){var t,n=e.field;return Object(h.jsx)(Ee,{placeholder:"Password confirmation",type:be.text,labelText:"Password confirmation",className:"form-sign-up__input",field:n,size:ge.large,isAvailableAutoComplete:!1,errorText:null===(t=p.passwordConfirm)||void 0===t?void 0:t.message})}}),Object(h.jsx)(Oe.a,{name:he.nickname,control:d,render:function(e){var t,n=e.field;return Object(h.jsx)(Ee,{placeholder:"Nickname",type:be.text,labelText:"Nickname",className:"form-sign-up__input",field:n,size:ge.large,errorText:null===(t=p.nickname)||void 0===t?void 0:t.message})}}),a.loadingState===Z.PENDING?Object(h.jsx)(T,{}):a.genderListFetchError?Object(h.jsxs)(x,{flex:!0,align:"center",children:["Failed to fetch gender list. Try again?",Object(h.jsx)(je,{iconName:E.updateIcon,type:G.button,onClick:c,arialabel:"Fetch gender list"})]}):Object(h.jsx)(Qe,{options:a.genderList,labelText:"Your gender",className:"form-sign-up__input",setValue:f,clearErrors:j,error:null===(e=p.gender)||void 0===e?void 0:e.message}),Object(h.jsxs)(x,{flex:!0,className:"form-sign-up__security-code",children:[Object(h.jsx)(Oe.a,{name:he.captcha,control:d,render:function(e){var t,n=e.field;return Object(h.jsx)(Ee,{placeholder:"Security code",type:be.text,labelText:"Security code",className:"form-sign-up__input",field:n,isAvailableAutoComplete:!1,size:ge.medium,errorText:null===(t=p.captcha)||void 0===t?void 0:t.message})}}),Object(h.jsx)(Ye,{})]}),Object(h.jsxs)(x,{flex:!0,className:"form-sign-up__buttons",children:[Object(h.jsx)(g,{className:"form-sign-up__button",variant:z.primary,size:V.medium,type:G.submit,isDisabled:!O,children:"Register"}),Object(h.jsx)(g,{className:"form-sign-up__button",variant:z.outline,size:V.medium,type:G.button,isNavLink:!0,path:A.SCREEN_LOGIN,children:"Log In"})]})]})]})})),et=(n(222),function(e){var t=e.header,n=e.authForm,a=e.isLoginPage;return Object(h.jsxs)(Ge,{page:U.auth,children:[Object(h.jsx)(x,{flex:!0,column:!0,align:"center",className:"auth-page__aside-form",children:Object(h.jsxs)(x,{className:a?"aside-form__login-inner":"aside-form__signup-inner",children:[t,n]})}),Object(h.jsx)(x,{className:"auth-page__aside-image"})]})}),tt=function(){var e=Object(u.i)("".concat(A.SCREEN_LOGIN)),t=Object(r.useContext)(fe).genderListStore;return Object(r.useEffect)((function(){t.fetchGenderList()}),[t]),Object(h.jsx)(et,{header:Object(h.jsx)(pe,{isLoginPage:!0}),authForm:e?Object(h.jsx)(He,{}):Object(h.jsx)($e,{}),isLoginPage:e})},nt=["component","isUserAuthenticate","redirectPath"],at=function(e){var t=e.component,n=e.isUserAuthenticate,a=e.redirectPath,s=Object(O.a)(e,nt);return Object(h.jsx)(u.b,Object(p.a)(Object(p.a)({},s),{},{render:function(e){return n?Object(h.jsx)(t,Object(p.a)({},e)):Object(h.jsx)(u.a,{to:a})}}))},st=Object(d.a)((function(){var e=Object(r.useContext)(fe).userStore.userInfo.isUserAuthenticate;return Object(h.jsx)(l.a,{basename:"/chat-app",children:Object(h.jsxs)(u.d,{children:[Object(h.jsx)(at,{component:qe,exact:!0,path:[A.SCREEN_DIALOGS,A.SCREEN_CURRENT_DIALOG],isUserAuthenticate:e,redirectPath:A.SCREEN_LOGIN}),Object(h.jsx)(at,{component:tt,exact:!0,path:[A.SCREEN_LOGIN,A.SCREEN_SIGN_UP,A.SCREEN_HOME],isUserAuthenticate:!e,redirectPath:A.SCREEN_DIALOGS}),Object(h.jsx)(u.b,{component:function(){return Object(h.jsx)(h.Fragment,{children:"404: Page not found"})}})]})})}));n(223);o.a.render(Object(h.jsx)(i.a.StrictMode,{children:Object(h.jsx)(st,{})}),document.getElementById("root"))},88:function(e,t,n){},94:function(e,t,n){},95:function(e,t,n){},97:function(e,t,n){var a={"./addFile.svg":[225,3],"./arrowDown.svg":[226,4],"./arrowLeft.svg":[227,5],"./closeCircleIcon.svg":[228,6],"./closeIcon.svg":[229,7],"./deleteIcon.svg":[230,8],"./femaleAvatar.svg":[231,9],"./inputError.svg":[232,10],"./loginPageFrame.svg":[233,11],"./loginPageFrameMobile.svg":[234,12],"./logo.svg":[235,13],"./maleAvatar.svg":[236,14],"./messageAreaFrame.svg":[237,15],"./noUserAvatar.svg":[238,16],"./sendMessage.svg":[239,17],"./spiner.svg":[240,18],"./spinnerCircle.svg":[241,19],"./updateIcon.svg":[242,20],"./userIcon.svg":[243,21],"./userList.svg":[244,22]};function s(e){if(!n.o(a,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=a[e],s=t[0];return n.e(t[1]).then((function(){return n(s)}))}s.keys=function(){return Object.keys(a)},s.id=97,e.exports=s},98:function(e,t,n){},99:function(e,t,n){}},[[224,1,2]]]);
//# sourceMappingURL=main.f23bd060.chunk.js.map